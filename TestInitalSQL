CREATE TABLE IF NOT EXISTS "__EFMigrationsHistory" (
    migration_id character varying(150) NOT NULL,
    product_version character varying(32) NOT NULL,
    CONSTRAINT pk___ef_migrations_history PRIMARY KEY (migration_id)
);

START TRANSACTION;

CREATE TABLE cafeteria_menus (
    id integer GENERATED BY DEFAULT AS IDENTITY,
    is_deleted boolean NOT NULL,
    timestamp bigint NOT NULL,
    CONSTRAINT pk_cafeteria_menus PRIMARY KEY (id)
);

CREATE TABLE gps_coordinate (
    id integer GENERATED BY DEFAULT AS IDENTITY,
    latitude double precision NOT NULL,
    longitude double precision NOT NULL,
    is_deleted boolean NOT NULL,
    timestamp bigint NOT NULL,
    CONSTRAINT pk_gps_coordinate PRIMARY KEY (id)
);

CREATE TABLE schools (
    id integer GENERATED BY DEFAULT AS IDENTITY,
    name text NOT NULL,
    email text NOT NULL,
    website text NOT NULL,
    phone_number text NOT NULL,
    is_deleted boolean NOT NULL,
    timestamp bigint NOT NULL,
    CONSTRAINT pk_schools PRIMARY KEY (id)
);

CREATE TABLE user_preferences (
    id integer GENERATED BY DEFAULT AS IDENTITY,
    user_id text NOT NULL,
    is_deleted boolean NOT NULL,
    timestamp bigint NOT NULL,
    CONSTRAINT pk_user_preferences PRIMARY KEY (id)
);

CREATE TABLE user_profiles (
    id integer GENERATED BY DEFAULT AS IDENTITY,
    user_id text NOT NULL,
    is_deleted boolean NOT NULL,
    timestamp bigint NOT NULL,
    CONSTRAINT pk_user_profiles PRIMARY KEY (id)
);

CREATE TABLE cafeteria_item (
    id integer GENERATED BY DEFAULT AS IDENTITY,
    category integer NOT NULL,
    name text NOT NULL,
    description text NOT NULL,
    icon_name text NOT NULL,
    cafeteria_menu_id integer,
    is_deleted boolean NOT NULL,
    timestamp bigint NOT NULL,
    CONSTRAINT pk_cafeteria_item PRIMARY KEY (id),
    CONSTRAINT fk_cafeteria_item_cafeteria_menus_cafeteria_menu_id FOREIGN KEY (cafeteria_menu_id) REFERENCES cafeteria_menus (id)
);

CREATE TABLE address (
    id integer GENERATED BY DEFAULT AS IDENTITY,
    gps_coordinate_id integer,
    street_address1 text NOT NULL,
    street_address2 text NOT NULL,
    city text NOT NULL,
    state text NOT NULL,
    postal_code text NOT NULL,
    country text NOT NULL,
    is_deleted boolean NOT NULL,
    timestamp bigint NOT NULL,
    CONSTRAINT pk_address PRIMARY KEY (id),
    CONSTRAINT fk_address_gps_coordinate_gps_coordinate_id FOREIGN KEY (gps_coordinate_id) REFERENCES gps_coordinate (id)
);

CREATE TABLE announcements (
    id integer GENERATED BY DEFAULT AS IDENTITY,
    title text NOT NULL,
    message text NOT NULL,
    school_id integer NOT NULL,
    is_deleted boolean NOT NULL,
    timestamp bigint NOT NULL,
    CONSTRAINT pk_announcements PRIMARY KEY (id),
    CONSTRAINT fk_announcements_schools_school_id FOREIGN KEY (school_id) REFERENCES schools (id) ON DELETE CASCADE
);

CREATE TABLE school_news (
    id integer GENERATED BY DEFAULT AS IDENTITY,
    headline text NOT NULL,
    content text NOT NULL,
    date_published timestamp with time zone NOT NULL,
    author text NOT NULL,
    school_id integer NOT NULL,
    is_deleted boolean NOT NULL,
    timestamp bigint NOT NULL,
    CONSTRAINT pk_school_news PRIMARY KEY (id),
    CONSTRAINT fk_school_news_schools_school_id FOREIGN KEY (school_id) REFERENCES schools (id) ON DELETE CASCADE
);

CREATE TABLE tutoring_centers (
    id integer GENERATED BY DEFAULT AS IDENTITY,
    school_id integer NOT NULL,
    is_deleted boolean NOT NULL,
    timestamp bigint NOT NULL,
    CONSTRAINT pk_tutoring_centers PRIMARY KEY (id),
    CONSTRAINT fk_tutoring_centers_schools_school_id FOREIGN KEY (school_id) REFERENCES schools (id) ON DELETE CASCADE
);

CREATE TABLE campuses (
    id integer GENERATED BY DEFAULT AS IDENTITY,
    name text NOT NULL,
    address_id integer NOT NULL,
    school_id integer NOT NULL,
    is_deleted boolean NOT NULL,
    timestamp bigint NOT NULL,
    CONSTRAINT pk_campuses PRIMARY KEY (id),
    CONSTRAINT fk_campuses_address_address_id FOREIGN KEY (address_id) REFERENCES address (id) ON DELETE CASCADE,
    CONSTRAINT fk_campuses_schools_school_id FOREIGN KEY (school_id) REFERENCES schools (id) ON DELETE CASCADE
);

CREATE TABLE business_offices (
    id integer GENERATED BY DEFAULT AS IDENTITY,
    campus_id integer NOT NULL,
    is_deleted boolean NOT NULL,
    timestamp bigint NOT NULL,
    CONSTRAINT pk_business_offices PRIMARY KEY (id),
    CONSTRAINT fk_business_offices_campuses_campus_id FOREIGN KEY (campus_id) REFERENCES campuses (id) ON DELETE CASCADE
);

CREATE TABLE librarys (
    id integer GENERATED BY DEFAULT AS IDENTITY,
    campus_id integer NOT NULL,
    is_deleted boolean NOT NULL,
    timestamp bigint NOT NULL,
    CONSTRAINT pk_librarys PRIMARY KEY (id),
    CONSTRAINT fk_librarys_campuses_campus_id FOREIGN KEY (campus_id) REFERENCES campuses (id) ON DELETE CASCADE
);

CREATE TABLE registrars (
    id integer GENERATED BY DEFAULT AS IDENTITY,
    campus_id integer NOT NULL,
    is_deleted boolean NOT NULL,
    timestamp bigint NOT NULL,
    CONSTRAINT pk_registrars PRIMARY KEY (id),
    CONSTRAINT fk_registrars_campuses_campus_id FOREIGN KEY (campus_id) REFERENCES campuses (id) ON DELETE CASCADE
);

CREATE TABLE school_events (
    id integer GENERATED BY DEFAULT AS IDENTITY,
    title text NOT NULL,
    description text NOT NULL,
    start timestamp with time zone NOT NULL,
    "end" timestamp with time zone NOT NULL,
    campus_id integer NOT NULL,
    location text NOT NULL,
    school_id integer,
    is_deleted boolean NOT NULL,
    timestamp bigint NOT NULL,
    CONSTRAINT pk_school_events PRIMARY KEY (id),
    CONSTRAINT fk_school_events_campuses_campus_id FOREIGN KEY (campus_id) REFERENCES campuses (id) ON DELETE CASCADE,
    CONSTRAINT fk_school_events_schools_school_id FOREIGN KEY (school_id) REFERENCES schools (id)
);

CREATE TABLE securitys (
    id integer GENERATED BY DEFAULT AS IDENTITY,
    campus_id integer NOT NULL,
    office_location text NOT NULL,
    contact_number text NOT NULL,
    emergency_number text NOT NULL,
    email text NOT NULL,
    is_deleted boolean NOT NULL,
    timestamp bigint NOT NULL,
    CONSTRAINT pk_securitys PRIMARY KEY (id),
    CONSTRAINT fk_securitys_campuses_campus_id FOREIGN KEY (campus_id) REFERENCES campuses (id) ON DELETE CASCADE
);

CREATE TABLE hours_of_operation (
    id integer GENERATED BY DEFAULT AS IDENTITY,
    day text NOT NULL,
    open_time interval NOT NULL,
    close_time interval NOT NULL,
    business_office_id integer,
    library_id integer,
    registrar_id integer,
    security_id integer,
    tutoring_center_id integer,
    is_deleted boolean NOT NULL,
    timestamp bigint NOT NULL,
    CONSTRAINT pk_hours_of_operation PRIMARY KEY (id),
    CONSTRAINT fk_hours_of_operation_business_offices_business_office_id FOREIGN KEY (business_office_id) REFERENCES business_offices (id),
    CONSTRAINT fk_hours_of_operation_librarys_library_id FOREIGN KEY (library_id) REFERENCES librarys (id),
    CONSTRAINT fk_hours_of_operation_registrars_registrar_id FOREIGN KEY (registrar_id) REFERENCES registrars (id),
    CONSTRAINT fk_hours_of_operation_securitys_security_id FOREIGN KEY (security_id) REFERENCES securitys (id),
    CONSTRAINT fk_hours_of_operation_tutoring_centers_tutoring_center_id FOREIGN KEY (tutoring_center_id) REFERENCES tutoring_centers (id)
);

CREATE TABLE security_alerts (
    id integer GENERATED BY DEFAULT AS IDENTITY,
    title text NOT NULL,
    message text NOT NULL,
    alert_date timestamp with time zone NOT NULL,
    level integer NOT NULL,
    is_active boolean NOT NULL,
    security_id integer NOT NULL,
    is_deleted boolean NOT NULL,
    timestamp bigint NOT NULL,
    CONSTRAINT pk_security_alerts PRIMARY KEY (id),
    CONSTRAINT fk_security_alerts_securitys_security_id FOREIGN KEY (security_id) REFERENCES securitys (id) ON DELETE CASCADE
);

CREATE INDEX ix_address_gps_coordinate_id ON address (gps_coordinate_id);

CREATE INDEX ix_announcements_school_id ON announcements (school_id);

CREATE INDEX ix_business_offices_campus_id ON business_offices (campus_id);

CREATE INDEX ix_cafeteria_item_cafeteria_menu_id ON cafeteria_item (cafeteria_menu_id);

CREATE INDEX ix_campuses_address_id ON campuses (address_id);

CREATE INDEX ix_campuses_school_id ON campuses (school_id);

CREATE INDEX ix_hours_of_operation_business_office_id ON hours_of_operation (business_office_id);

CREATE INDEX ix_hours_of_operation_library_id ON hours_of_operation (library_id);

CREATE INDEX ix_hours_of_operation_registrar_id ON hours_of_operation (registrar_id);

CREATE INDEX ix_hours_of_operation_security_id ON hours_of_operation (security_id);

CREATE INDEX ix_hours_of_operation_tutoring_center_id ON hours_of_operation (tutoring_center_id);

CREATE INDEX ix_librarys_campus_id ON librarys (campus_id);

CREATE INDEX ix_registrars_campus_id ON registrars (campus_id);

CREATE INDEX ix_school_events_campus_id ON school_events (campus_id);

CREATE INDEX ix_school_events_school_id ON school_events (school_id);

CREATE INDEX ix_school_news_school_id ON school_news (school_id);

CREATE INDEX ix_security_alerts_security_id ON security_alerts (security_id);

CREATE INDEX ix_securitys_campus_id ON securitys (campus_id);

CREATE INDEX ix_tutoring_centers_school_id ON tutoring_centers (school_id);

INSERT INTO "__EFMigrationsHistory" (migration_id, product_version)
VALUES ('20250916140542_InitialMigration', '8.0.20');

COMMIT;
